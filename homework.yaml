---
- name: Prepare GUID environment variable across all hosts
  hosts: all
  tasks:
    - name: All GUID env variable
      shell: export GUID=`hostname | cut -d"." -f2`; echo "export GUID=$GUID" >> $HOME/.bashrc

- name: Verify Installation and Configuration of Docker
  hosts: nodes
  tasks:
    - name: docker restart
      shell: systemctl restart docker

#- name: Verify NFS Shared Volumes on Hosts
#  hosts: nfs
#  tasks:
#    - name: "Verify PVs"
#      script: /root/ocp_advanced_deployment_homework/scripts/create_pvs.sh

- name: Generate Inventory Hosts File
  hosts: localhost
  tasks:
    - name: Generate Inventory script
      script: /root/ocp_advanced_deployment_homework/scripts/generate_inventory.sh

- name: Execute the openshift-ansible prerequisites
  import_playbook: /usr/share/ansible/openshift-ansible/playbooks/prerequisites.yml
  tags:
    - install

- name: Execute the openshift-ansible Deployer
  import_playbook: /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml
  tags:
    - install

- name: Verify OpenShift Cluster
  hosts: masters[0]
  tasks:
    - name: copy the .kube directory from master1 to your bastion
      fetch: 
        src: "/root/.kube/config"
        dest: "/root/.kube/config"
        flat: "yes"

- name: Post installation configuration
  hosts: localhost
  tasks:
    - name: make sure you are system:dmin
      shell: oc whoami | grep system:admin

- name: Create PVs for Users
  hosts: nfs
  tasks:
    - name: "Create PV directories and add them to be exported"
      script: ./scripts/create_pvs.sh
    - name: Restarting NFS Server...
      shell: systemctl restart nfs-server
  tags:
    - nfs

- name: Create 25 definitions files for PVs 5G size
  hosts: localhost
  script: ./scripts/pvs_5Gsize.sh
  
- name: Create 25 definitions files for PVs 10G size
  hosts: localhost
  script: ./scripts/pvs_10Gsize.sh

- name: Create all PVs from definitions files
  hosts: localhost
  shell: "cat /root/pvs/*.yml | oc create -f -"

- name: Fix NFS Persistent Volume Recycling
  hosts: nodes
  tasks:
    - name: "pull the recycler image"
      shell: docker pull registry.access.redhat.com/openshift3/ose-recycler:latest
    - name "tag the recycler image for specific version"
      shell: docker tag registry.access.redhat.com/openshift3/ose-recycler:latest registry.access.redhat.com/openshift3/ose-recycler:v3.9.30

- name: Smoke Test

- name: HPA configuration on production deployment of openshift-tasks
  hosts: localhost
  tasks:

- name: Creation of users for Alpha and Beta clients

- name: Assigning labels to the users according to its group

- name: Setup the environment for Alpha and Beta clients

